# CT-To-Report

## Description
This is the Python implementation of the work presented in "Recognise and Describe: Automatically Generating Narrative-Style Radiology Reports from Volumetric CT Images, a Proof of Concept", available on [ArXiv](todo: include hyperlink) and this repository.

This repository is split into 3 main sections: <br>
* "Encoder" contains a Pytorch Lightning framework to train a multi-label classification model on volumetric imaging data.<br>
* "Decoder" contains a Pytorch Lightning framework to train a LLM to generate radiology reports, conditioned on the encoded images.<br>
* "SARLE" contains code to automatically mine classification labels from radiology reports.<br>


If you find this work useful in your research, please consider citing me: (Todo include formatted citation example)

## Usage
1) Though the code for this work is publicly available, the dataset is not. 
Hence, the first step to using this framework is to obtain a dataset of volumetric images with associated narrative-style radiology reports.
The dataset should be formatted as:

[IMAGE_DIR]<br>
│   [hospital_name_1]<br>
│   │   [hospital_name_1]_[pseudo_id_1]<br>
│   │   │   [IMAGE_FILE_NAME]<br>
│   │   [hospital_name_1]_[pseudo_id_2]<br>
│   │   │   [IMAGE_FILE_NAME]<br>
│   │   ...<br>
│   │   labels.xlsx<br>
│   │   verslagen.docs<br>
│   [hospital_name_2]<br>
│   │   [hospital_name_2]_[pseudo_id_1]<br>
│   │   │   [IMAGE_FILE_NAME]<br>
│   │   [hospital_name_2]_[pseudo_id_2]<br>
│   │   │   [IMAGE_FILE_NAME]<br>
│   │   ...<br>
│   │   labels.xlsx<br>
│   │   verslagen.docs<br>
│   ...<br>
│   all_labels.xlsx<br>
│   all_reports.docs<br>
│   SARLE_dataset.xlsx<br>

2) Optionally the images can be pr-processed.
In Encoder/data_prepressing there are files to a) automatically save seperate segmentations of up to 104 anatomical regions in every sample in the dataset, b) automatically apply these masks to the image for every sample in the dataset, c) Automatically introduce a combination of artifical abnormality to the images such as a mirroring, a rotation or the occlusion of a lung lobe. 

3) Run the SARLE algorithm on the radiology reports to generate classification labels for the encoder.

4) Train an encoder model in the "encoder" section using the volumetric images and the classification labels generated by SARLE. Pre-processing steps such as rescaling, padding, and normalizing are implemented in the dataloader of this model.  
   
6) Pass all images through a trained encoder model and save the encoded images to files.
   
8) Train an decoder model using the encoded images that were saved in 6) and the radiology reports.




